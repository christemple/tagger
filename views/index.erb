<html>
  <head>
    <title>Tagger</title>
      <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.1.0/pure-min.css">
      <link href="/css/style.css" rel=stylesheet>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
  </head>
  <body>

    <div class=pure-g>
        <div class=pure-u-1 id=tag_selector>
            <form id="tags" method="post" action="/">
                <div class="tag_wrapper">
                    <div class=selected_tags></div>
                    <div class=available_tags>
                        <% $tagger.distinct('tags').sort().each do |distinct_tag| %>
                            <div class="available_tag" data-available-tag="<%= distinct_tag %>"><%= distinct_tag %></div>
                        <% end %>
                    </div>
                    <div class=drop_down_button><span class="arrow"></span></div>
                </div>
                <button class=refresh_button><span class=refresh></span></button>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        function add_tag_to_list(selected_tag) {
            var add_tag_html = '<input name="selected_tags[]" data-selected-tag="'+ selected_tag +'" value="'+ selected_tag +'" type="hidden" />';
            add_tag_html += '<div class=selected_tag data-selected-tag="'+ selected_tag +'">' + selected_tag + '<span class=remove_selected_tag>x</span></div>';
            $('.selected_tags').append(add_tag_html);
        }

        function remove_tag_from_list(selected_tag) {
            $('*[data-selected-tag="'+ selected_tag +'"]').remove();
            $('*[data-available-tag="'+ selected_tag +'"]').removeClass('disabled');
        }

        $('.refresh_button').click(function(){ $('#tags').submit(); });
        $('#tags').submit(function(e){
            if ($(this).serializeArray().length == 1) {
                return false;
            }
        });

        $('.drop_down_button').click(function(){
            $('.available_tags').toggle();
        });

        $('.available_tag').click(function(){
            if (!$(this).hasClass('disabled')) {
                add_tag_to_list($(this).text());
                $(this).addClass('disabled');
            }
        });

        $('body').on("click", ".remove_selected_tag", function(e){
            var tag_being_removed = $(this).parent().data('selected-tag');
            remove_tag_from_list(tag_being_removed);
            $(this).parent().remove();
        });
    </script>

  </body>
</html>
